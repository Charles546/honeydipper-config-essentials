<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>gcloud-dataflow</title><link rel="stylesheet" type="text/css" href="../../../../styles/main.css" /><script type="text/javascript" src="../../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Topic19"></a><div class="CTopic TSection LHoneydipperConfig first">
 <div class="CTitle"><span class="Qualifier">Gcloud.&#8203;Drivers.</span>&#8203;gcloud-dataflow</div>
 <div class="CBody"><p>Creating and managing dataflow job</p><div class="CHeading">Prereq</div><ul><li><p>include the gcloud bundle from this repo</p></li></ul><div class="CHeading">Integration</div><p>Config the driver in the `drivers` section with following parameters.</p><ul><li><p>loglevel: the verbosity of logs generated by this driver, DEBUG, INFO, WARNING, ERROR</p></li></ul><div class="CHeading">Example</div><pre>---<br />drivers:<br />  gloud-dataflow:<br />    loglevel: DEBUG</pre></div>
</div>

<a name="RawActions"></a><a name="Topic20"></a><div class="CTopic TGroup LHoneydipperConfig">
 <div class="CTitle">RawActions</div>
</div>

<a name="createJob"></a><a name="Topic21"></a><div class="CTopic TRawAction LHoneydipperConfig">
 <div class="CTitle">createJob</div>
 <div class="CBody"><p>create dataflow job with a template.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">service_account</td><td class="CDLDefinition"><p>the service account used for accessing gcloud to create the job</p></td></tr><tr><td class="CDLEntry">project</td><td class="CDLDefinition"><p>the GCP project</p></td></tr><tr><td class="CDLEntry">location</td><td class="CDLDefinition"><p>required for location based dataflow job</p></td></tr><tr><td class="CDLEntry">regional</td><td class="CDLDefinition"><p>set to true for regional dataflow job, ignoring location, defaults to false</p></td></tr><tr><td class="CDLEntry">job</td><td class="CDLDefinition"><p>the specification for the job, see <a href="https://godoc.org/google.golang.org/api/dataflow/v1b3#CreateJobFromTemplateRequest" target="_top">https://&#8203;godoc&#8203;.org&#8203;/google&#8203;.golang&#8203;.org&#8203;/api&#8203;/dataflow&#8203;/v1b3&#8203;#CreateJobFromTemplateRequest</a> for detail</p></td></tr></table><div class="CHeading">Return</div><table class="CDefinitionList"><tr><td class="CDLEntry">.data.job</td><td class="CDLDefinition"><p>the job object, see <a href="https://godoc.org/google.golang.org/api/dataflow/v1b3#Job" target="_top">https://&#8203;godoc&#8203;.org&#8203;/google&#8203;.golang&#8203;.org&#8203;/api&#8203;/dataflow&#8203;/v1b3&#8203;#Job</a> for detail</p></td></tr></table><div class="CHeading">Examples</div><p>Create a new job with teamplate.</p><pre>rules:<br />  - when:<br />      ...<br />  - do:<br />      type: function<br />      content:<br />        driver: gcloud-dataflow<br />        rawAction: createJob<br />        parameters:<br />          service_account: xxxxxxx<br />          project: example-project<br />          location: us-west1-c<br />          job:<br />            ...</pre></div>
</div>

<a name="waitForJob"></a><a name="Topic22"></a><div class="CTopic TRawAction LHoneydipperConfig">
 <div class="CTitle">waitForJob</div>
 <div class="CBody"><p>wait for the dataflow job to reach terminal states and return a job status.</p><pre>terminatedStates := map[string]bool{<br />  &quot;JOB_STATE_DONE&quot;:      true,<br />  &quot;JOB_STATE_FAILED&quot;:    true,<br />  &quot;JOB_STATE_CANCELLED&quot;: true,<br />  &quot;JOB_STATE_UPDATED&quot;:   true,<br />  &quot;JOB_STATE_DRAINED&quot;:   true,<br />}</pre><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">service_account</td><td class="CDLDefinition"><p>the service account used for accessing gcloud to create the job</p></td></tr><tr><td class="CDLEntry">project</td><td class="CDLDefinition"><p>the GCP project</p></td></tr><tr><td class="CDLEntry">location</td><td class="CDLDefinition"><p>required for location based dataflow job</p></td></tr><tr><td class="CDLEntry">regional</td><td class="CDLDefinition"><p>set to true for regional dataflow job, ignoring location, defaults to false</p></td></tr><tr><td class="CDLEntry">jobID</td><td class="CDLDefinition"><p>the ID of the job</p></td></tr><tr><td class="CDLEntry">timeout</td><td class="CDLDefinition"><p>time period before a timeout error is raised</p></td></tr><tr><td class="CDLEntry">interval</td><td class="CDLDefinition"><p>the interval between API calls polling the job status</p></td></tr></table><div class="CHeading">Return</div><p>.data.job -- the job object, see <a href="https://godoc.org/google.golang.org/api/dataflow/v1b3#Job" target="_top">https://&#8203;godoc&#8203;.org&#8203;/google&#8203;.golang&#8203;.org&#8203;/api&#8203;/dataflow&#8203;/v1b3&#8203;#Job</a> for detail</p><div class="CHeading">Examples</div><p>Wait for a job to complete.</p><pre>rules:<br />  - when:<br />      ...<br />  - do:<br />      type: function<br />      content:<br />        driver: gcloud-dataflow<br />        rawAction: waitForJob<br />        parameters:<br />          service_account: xxxxxxx<br />          project: example-project<br />          location: us-west1-c<br />          jobID: ...<br />          timeout: 1800<br />          interval: 10</pre></div>
</div>

<a name="getJob"></a><a name="Topic23"></a><div class="CTopic TRawAction LHoneydipperConfig">
 <div class="CTitle">getJob</div>
 <div class="CBody"><p>query the job info and status with a jobID</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">service_account</td><td class="CDLDefinition"><p>the service account used for accessing gcloud to create the job</p></td></tr><tr><td class="CDLEntry">project</td><td class="CDLDefinition"><p>the GCP project</p></td></tr><tr><td class="CDLEntry">location</td><td class="CDLDefinition"><p>required for location based dataflow job</p></td></tr><tr><td class="CDLEntry">regional</td><td class="CDLDefinition"><p>set to true for regional dataflow job, ignoring location, defaults to false</p></td></tr><tr><td class="CDLEntry">jobID</td><td class="CDLDefinition"><p>the ID of the job</p></td></tr></table><div class="CHeading">Return</div><p>.data.job -- the job object, see <a href="https://godoc.org/google.golang.org/api/dataflow/v1b3#Job" target="_top">https://&#8203;godoc&#8203;.org&#8203;/google&#8203;.golang&#8203;.org&#8203;/api&#8203;/dataflow&#8203;/v1b3&#8203;#Job</a> for detail</p><div class="CHeading">Examples</div><pre>workflows:<br />  check-dataflow-job-status:<br />    type: pipe<br />    content:<br />      - type: <span class="SHKeyword">function</span><br />        content:<br />          driver: gcloud-dataflow<br />          rawAction: getJob<br />          parameters:<br />            service_account: xxxxxxx<br />            project: example-project<br />            location: us-west1-c<br />            jobID: {{ .wfdata.jobID }}<br />      - content: notify<br />        data:<br />          message:<br />            attachments:<br />              - color: <span class="SHString">'{{ ternary &quot;good&quot; &quot;danger&quot; (eq .data.job.currentState &quot;JOB_STATE_DONE&quot;) }}'</span><br />                text: Job state is {{ .data.job.currentState }}</pre></div>
</div>

<a name="listJob"></a><a name="Topic24"></a><div class="CTopic TRawAction LHoneydipperConfig last">
 <div class="CTitle">listJob</div>
 <div class="CBody"><p>query a list of jobs with given filter and fields list.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">service_account</td><td class="CDLDefinition"><p>the service account used for accessing gcloud to create the job</p></td></tr><tr><td class="CDLEntry">project</td><td class="CDLDefinition"><p>the GCP project</p></td></tr><tr><td class="CDLEntry">location</td><td class="CDLDefinition"><p>required for location based dataflow job</p></td></tr><tr><td class="CDLEntry">fields</td><td class="CDLDefinition"><p>the list of fields to query</p></td></tr><tr><td class="CDLEntry">filter</td><td class="CDLDefinition"><p>the filter, see <a href="https://godoc.org/google.golang.org/api/dataflow/v1b3#ProjectsJobsListCall.Filter" target="_top">https://&#8203;godoc&#8203;.org&#8203;/google&#8203;.golang&#8203;.org&#8203;/api&#8203;/dataflow&#8203;/v1b3&#8203;#ProjectsJobsListCall&#8203;.Filter</a></p></td></tr></table><div class="CHeading">Return</div><table class="CDefinitionList"><tr><td class="CDLEntry">.data.result</td><td class="CDLDefinition"><p>see <a href="https://godoc.org/google.golang.org/api/dataflow/v1b3#ListJobsResponse" target="_top">https://&#8203;godoc&#8203;.org&#8203;/google&#8203;.golang&#8203;.org&#8203;/api&#8203;/dataflow&#8203;/v1b3&#8203;#ListJobsResponse</a> for detail</p></td></tr></table></div>
</div>

</body></html>