<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>kubernetes</title><link rel="stylesheet" type="text/css" href="../../../../styles/main.css" /><script type="text/javascript" src="../../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Topic24"></a><div class="CTopic TSection LHoneydipperConfig first">
 <div class="CTitle"><span class="Qualifier">Essentials.&#8203;Drivers.</span>&#8203;kubernetes</div>
 <div class="CBody"><p>interacting with kubernetes objects using kubernetes API</p><div class="CHeading">Prereq</div><ul><li><p>include the basic bundle from this repo</p></li></ul><div class="CHeading">Integration</div><p>Config the driver in the `drivers` section with following parameters.</p><ul><li><p>loglevel: the verbosity of logs generated by this driver, DEBUG, INFO, WARNING, ERROR</p></li></ul><div class="CHeading">Example</div><pre>---<br />drivers:<br />  kubernetes:<br />    loglevel: DEBUG</pre></div>
</div>

<a name="RawActions"></a><a name="Topic25"></a><div class="CTopic TGroup LHoneydipperConfig">
 <div class="CTitle">RawActions</div>
</div>

<a name="recycleDeployment"></a><a name="Topic26"></a><div class="CTopic TRawAction LHoneydipperConfig">
 <div class="CTitle">recycleDeployment</div>
 <div class="CBody"><p>Recycle a deployment by delete its replicaset. Thanks to the deployment manager, the new replicaset will be created before the old one is destroyed.</p><div class="CHeading">Parameters</div><ul><li><p>deployment: a label selector for the deployment (required)</p></li><li><p>namespace: the namespace where the deployment is in, defaults to &quot;default&quot;</p></li><li><p>source: the cluster information</p><ul><li><p>type: which driver provides the cluster information, (gcloud-gke, local, etc.)</p></li><li><p>... needed for the making a RPC call to the driver to fetch cluster endpoint and auth info.</p></li></ul></li></ul><div class="CHeading">Return</div><p>Use &quot;.label.status&quot; in `interpolation` to check status, &quot;success&quot; or &quot;failure&quot;.</p><div class="CHeading">Example</div><pre>---<br />rules:<br />  - when:<br />      ...<br />    do:<br />      type: function<br />      content:<br />        driver: kubernetes<br />        rawAction: recycleDeployment<br />        parameters:<br />          source:<br />            type: gcloud-gke<br />            service_account: xxxxx...<br />            project: example<br />            location: us-west1-b<br />            cluster: example<br />          namespace: mynamespace<br />          deployment: run=busybox</pre></div>
</div>

<a name="createJob"></a><a name="Topic27"></a><div class="CTopic TRawAction LHoneydipperConfig">
 <div class="CTitle">createJob</div>
 <div class="CBody"><p>Create a run to completion job in the specified kubernetes cluster.</p><div class="CHeading">Parameters</div><ul><li><p>job: the complete kubernetes manifest for a `job` object</p></li><li><p>namespace: the namespace where the job will be created, defaults to &quot;default&quot;</p></li><li><p>source: the cluster information</p><ul><li><p>type: which driver provides the cluster information, (gcloud-gke, local, etc.)</p></li><li><p>... needed for the making a RPC call to the driver to fetch cluster endpoint and auth info.</p></li></ul></li></ul><div class="CHeading">Return</div><p>Use &quot;.label.status&quot; in `interpolation` to check status, &quot;success&quot; or &quot;failure&quot;.</p><ul><li><p>.label.status:&nbsp; &quot;success&quot; or &quot;failure&quot;</p></li><li><p>.data.meta:&nbsp; the metadata including the generated name of the job</p></li><li><p>.data.status:&nbsp; the status of the job</p></li></ul><div class="CHeading">Example</div><pre>---<br />rules:<br />  - when:<br />      ...<br />    do:<br />      type: function<br />      content:<br />        driver: kubernetes<br />        rawAction: createJob<br />        parameters:<br />          source:<br />            type: local<br />          namespace: mynamespace<br />          job:<br />            kind: job<br />            apiVersion: ...<br />            ...</pre></div>
</div>

<a name="waitForJob"></a><a name="Topic28"></a><div class="CTopic TRawAction LHoneydipperConfig">
 <div class="CTitle">waitForJob</div>
 <div class="CBody"><p>Wait for a job to complete/terminate</p><div class="CHeading">Parameters</div><ul><li><p>job: the metadata.name of the job</p></li><li><p>timeout: the number of seconds to wait for job to complete/terminate</p></li><li><p>namespace: the namespace where the job will be created, defaults to &quot;default&quot;</p></li><li><p>source: the cluster information</p><ul><li><p>type: which driver provides the cluster information, (gcloud-gke, local, etc.)</p></li><li><p>... needed for the making a RPC call to the driver to fetch cluster endpoint and auth info.</p></li></ul></li></ul><div class="CHeading">Return</div><p>If the job doesn't complete/terminate within the time period, you will get a timeout error.</p><ul><li><p>.label.status:&nbsp; &quot;success&quot; or &quot;failure&quot;</p></li><li><p>.label.reason:&nbsp; &quot;time out&quot; etc.</p></li><li><p>.data.status:&nbsp; the status of the job</p></li></ul><div class="CHeading">Example</div><pre>---<br />rules:<br />  - when:<br />      ...<br />    do:<br />      type: function<br />      content:<br />        driver: kubernetes<br />        rawAction: waitForJob<br />        parameters:<br />          source:<br />            type: local<br />          namespace: mynamespace<br />          job: myjob</pre></div>
</div>

<a name="getJobLog"></a><a name="Topic29"></a><div class="CTopic TRawAction LHoneydipperConfig last">
 <div class="CTitle">getJobLog</div>
 <div class="CBody"><p>get the container logs from the kubernetes job object.</p><div class="CHeading">Parameters</div><ul><li><p>job: the metadata.name of the job</p></li><li><p>namespace: the namespace where the job will be created, defaults to &quot;default&quot;</p></li><li><p>source: the cluster information</p><ul><li><p>type: which driver provides the cluster information, (gcloud-gke, local, etc.)</p></li><li><p>... needed for the making a RPC call to the driver to fetch cluster endpoint and auth info.</p></li></ul></li></ul><div class="CHeading">Return</div><ul><li><p>.label.status:&nbsp; &quot;success&quot; or &quot;failure&quot;</p></li><li><p>.data.log:&nbsp; map of pod name to map of container name to log text</p></li></ul><div class="CHeading">Example</div><pre>---<br />rules:<br />  - when:<br />      ...<br />    do:<br />      type: function<br />      content:<br />        driver: kubernetes<br />        rawAction: getJobLog<br />        parameters:<br />          source:<br />            type: local<br />          namespace: mynamespace<br />          job: myjob</pre></div>
</div>

</body></html>